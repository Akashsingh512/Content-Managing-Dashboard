import React, { useState, useEffect } from 'react';
import { Calendar, Plus, Edit2, Trash2, X, ExternalLink, Search, Download, Copy, TrendingUp, BarChart3, Menu, Settings, RefreshCw, CheckCircle, AlertCircle } from 'lucide-react';

import React, { useState, useEffect } from 'react';
import { Calendar, Plus, Edit2, Trash2, X, ExternalLink, Search, Download, Copy, TrendingUp, BarChart3, Menu, Settings, RefreshCw, CheckCircle, AlertCircle } from 'lucide-react';

const ContentCalendarDashboard = () => {
  const [activeView, setActiveView] = useState('dashboard');
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [posts, setPosts] = useState([]);
  const [editingPost, setEditingPost] = useState(null);
  const [formData, setFormData] = useState({
    title: '',
    tag: '',
    topic: '',
    description: '',
    date: '',
    link: '',
    status: 'Draft',
    platform: 'Instagram'
  });

  const [searchQuery, setSearchQuery] = useState('');
  const [filterStatus, setFilterStatus] = useState('All');
  const [filterTag, setFilterTag] = useState('All');
  const [filterPlatform, setFilterPlatform] = useState('All');
  const [dateRange, setDateRange] = useState('All');

  const [sheetConfig, setSheetConfig] = useState({
    spreadsheetId: '',
    serviceAccount: ''
  });
  const [syncStatus, setSyncStatus] = useState({ message: '', type: '' });
  const [isSyncing, setIsSyncing] = useState(false);
  const [isConnected, setIsConnected] = useState(false);

  const statusOptions = ['Draft', 'Scheduled', 'Published', 'Archived'];
  const platformOptions = ['Instagram', 'Facebook', 'Twitter', 'LinkedIn', 'YouTube', 'TikTok', 'Blog'];

  useEffect(() => {
    const savedConfig = localStorage.getItem('sheetConfig');
    if (savedConfig) {
      const config = JSON.parse(savedConfig);
      setSheetConfig(config);
      if (config.spreadsheetId && config.serviceAccount) {
        setIsConnected(true);
        loadFromSheets(config);
      }
    }
  }, []);

  const getAccessToken = async (serviceAccountJson) => {
    try {
      const serviceAccount = JSON.parse(serviceAccountJson);
      const header = { alg: 'RS256', typ: 'JWT' };
      const now = Math.floor(Date.now() / 1000);
      const claim = {
        iss: serviceAccount.client_email,
        scope: 'https://www.googleapis.com/auth/spreadsheets',
        aud: 'https://oauth2.googleapis.com/token',
        exp: now + 3600,
        iat: now
      };

      const base64Encode = (str) => btoa(String.fromCharCode(...new Uint8Array(str)));
      const base64UrlEncode = (str) => {
        return btoa(str).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
      };

      const headerEncoded = base64UrlEncode(JSON.stringify(header));
      const claimEncoded = base64UrlEncode(JSON.stringify(claim));
      const signatureInput = `${headerEncoded}.${claimEncoded}`;

      const pemHeader = "-----BEGIN PRIVATE KEY-----";
      const pemFooter = "-----END PRIVATE KEY-----";
      const pemContents = serviceAccount.private_key.substring(pemHeader.length, serviceAccount.private_key.length - pemFooter.length);
      const binaryDer = Uint8Array.from(atob(pemContents), c => c.charCodeAt(0));

      const key = await crypto.subtle.importKey(
        'pkcs8',
        binaryDer,
        { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-256' },
        false,
        ['sign']
      );

      const signature = await crypto.subtle.sign(
        'RSASSA-PKCS1-v1_5',
        key,
        new TextEncoder().encode(signatureInput)
      );

      const signatureEncoded = base64UrlEncode(String.fromCharCode(...new Uint8Array(signature)));
      const jwt = `${signatureInput}.${signatureEncoded}`;

      const response = await fetch('https://oauth2.googleapis.com/token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=${jwt}`
      });

      const data = await response.json();
      return data.access_token;
    } catch (error) {
      console.error('Error getting access token:', error);
      throw error;
    }
  };

  const loadFromSheets = async (config = sheetConfig) => {
    if (!config.spreadsheetId || !config.serviceAccount) {
      setSyncStatus({ message: 'Please configure Google Sheets settings', type: 'error' });
      return;
    }

    setIsSyncing(true);
    try {
      const accessToken = await getAccessToken(config.serviceAccount);
      const response = await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${config.spreadsheetId}/values/Sheet1!A2:I`,
        {
          headers: { Authorization: `Bearer ${accessToken}` }
        }
      );

      const data = await response.json();
      if (data.values && data.values.length > 0) {
        const loadedPosts = data.values.map((row, index) => ({
          id: row[0] || Date.now() + index,
          title: row[1] || '',
          tag: row[2] || '',
          topic: row[3] || '',
          description: row[4] || '',
          date: row[5] || '',
          link: row[6] || '',
          status: row[7] || 'Draft',
          platform: row[8] || 'Instagram'
        }));
        setPosts(loadedPosts);
        setSyncStatus({ message: 'Successfully loaded from Google Sheets!', type: 'success' });
        setIsConnected(true);
      } else {
        setPosts([]);
        setSyncStatus({ message: 'Sheet is empty. Add your first post!', type: 'success' });
        setIsConnected(true);
      }
    } catch (error) {
      setSyncStatus({ message: 'Failed to load from Google Sheets: ' + error.message, type: 'error' });
      setIsConnected(false);
    }
    setIsSyncing(false);
  };

  const saveToSheets = async (updatedPosts = posts) => {
    if (!sheetConfig.spreadsheetId || !sheetConfig.serviceAccount) {
      setSyncStatus({ message: 'Please configure Google Sheets settings', type: 'error' });
      return;
    }

    setIsSyncing(true);
    try {
      const accessToken = await getAccessToken(sheetConfig.serviceAccount);
      
      const values = [
        ['ID', 'Title', 'Tag', 'Topic', 'Description', 'Date', 'Link', 'Status', 'Platform'],
        ...updatedPosts.map(post => [
          post.id,
          post.title,
          post.tag,
          post.topic,
          post.description,
          post.date,
          post.link || '',
          post.status,
          post.platform
        ])
      ];

      await fetch(
        `https://sheets.googleapis.com/v4/spreadsheets/${sheetConfig.spreadsheetId}/values/Sheet1!A1:I?valueInputOption=RAW`,
        {
          method: 'PUT',
          headers: {
            Authorization: `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ values })
        }
      );

      setSyncStatus({ message: 'Successfully synced to Google Sheets!', type: 'success' });
      setIsConnected(true);
    } catch (error) {
      setSyncStatus({ message: 'Failed to sync to Google Sheets: ' + error.message, type: 'error' });
      setIsConnected(false);
    }
    setIsSyncing(false);
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSubmit = () => {
    if (!formData.title || !formData.tag || !formData.topic || !formData.description || !formData.date) {
      alert('Please fill in all required fields');
      return;
    }

    let updatedPosts;
    if (editingPost) {
      updatedPosts = posts.map(post => 
        post.id === editingPost.id ? { ...formData, id: post.id } : post
      );
      setEditingPost(null);
    } else {
      updatedPosts = [...posts, { ...formData, id: Date.now() }];
    }
    
    setPosts(updatedPosts);
    resetForm();
    setActiveView('dashboard');
    setSidebarOpen(false);
    
    if (isConnected) {
      saveToSheets(updatedPosts);
    }
  };

  const resetForm = () => {
    setFormData({
      title: '',
      tag: '',
      topic: '',
      description: '',
      date: '',
      link: '',
      status: 'Draft',
      platform: 'Instagram'
    });
  };

  const handleEdit = (post) => {
    setEditingPost(post);
    setFormData(post);
    setActiveView('admin');
    setSidebarOpen(false);
  };

  const handleDelete = (id) => {
    if (window.confirm('Are you sure you want to delete this post?')) {
      const updatedPosts = posts.filter(post => post.id !== id);
      setPosts(updatedPosts);
      if (isConnected) {
        saveToSheets(updatedPosts);
      }
    }
  };

  const handleStatusChange = (id, newStatus) => {
    const updatedPosts = posts.map(post => 
      post.id === id ? { ...post, status: newStatus } : post
    );
    setPosts(updatedPosts);
    if (isConnected) {
      saveToSheets(updatedPosts);
    }
  };

  const handleDuplicate = (post) => {
    const newPost = {
      ...post,
      id: Date.now(),
      title: post.title + ' (Copy)',
      status: 'Draft'
    };
    const updatedPosts = [...posts, newPost];
    setPosts(updatedPosts);
    if (isConnected) {
      saveToSheets(updatedPosts);
    }
  };

  const exportToCSV = () => {
    const headers = ['Title', 'Tag', 'Topic', 'Description', 'Date', 'Platform', 'Status', 'Link'];
    const csvContent = [
      headers.join(','),
      ...filteredPosts.map(post => 
        [post.title, post.tag, post.topic, post.description, post.date, post.platform, post.status, post.link || ''].join(',')
      )
    ].join('\n');
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'content_calendar.csv';
    a.click();
  };

  const saveSettings = () => {
    localStorage.setItem('sheetConfig', JSON.stringify(sheetConfig));
    setShowSettings(false);
    setSyncStatus({ message: 'Settings saved! Click sync to load data.', type: 'success' });
  };

  const getUniqueTags = () => {
    const tags = posts.map(post => post.tag);
    return ['All', ...new Set(tags)];
  };

  const filterByDateRange = (post) => {
    if (dateRange === 'All') return true;
    const postDate = new Date(post.date);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    switch(dateRange) {
      case 'Today':
        return postDate.toDateString() === today.toDateString();
      case 'This Week':
        const weekFromNow = new Date(today);
        weekFromNow.setDate(today.getDate() + 7);
        return postDate >= today && postDate <= weekFromNow;
      case 'This Month':
        return postDate.getMonth() === today.getMonth() && postDate.getFullYear() === today.getFullYear();
      case 'Past':
        return postDate < today;
      default:
        return true;
    }
  };

  const filteredPosts = posts
    .filter(post => {
      const matchesSearch = post.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                           post.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
                           post.topic.toLowerCase().includes(searchQuery.toLowerCase());
      const matchesStatus = filterStatus === 'All' || post.status === filterStatus;
      const matchesTag = filterTag === 'All' || post.tag === filterTag;
      const matchesPlatform = filterPlatform === 'All' || post.platform === filterPlatform;
      const matchesDateRange = filterByDateRange(post);
      
      return matchesSearch && matchesStatus && matchesTag && matchesPlatform && matchesDateRange;
    })
    .sort((a, b) => new Date(a.date) - new Date(b.date));

  const upcomingPosts = posts.filter(post => {
    const postDate = new Date(post.date);
    const today = new Date();
    const weekFromNow = new Date(today);
    weekFromNow.setDate(today.getDate() + 7);
    return postDate >= today && postDate <= weekFromNow && post.status === 'Scheduled';
  });

  return (
    <div className="min-h-screen bg-gray-50">
      {showSettings && (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-900">Google Sheets Settings</h2>
              <button onClick={() => setShowSettings(false)} className="text-gray-400 hover:text-gray-600">
                <X className="w-6 h-6" />
              </button>
            </div>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Spreadsheet ID *
                </label>
                <input
                  type="text"
                  value={sheetConfig.spreadsheetId}
                  onChange={(e) => setSheetConfig({...sheetConfig, spreadsheetId: e.target.value})}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                  placeholder="Get from sheet URL: /d/YOUR_SHEET_ID/edit"
                />
                <p className="text-xs text-gray-500 mt-1">
                  Found in your Google Sheet URL between /d/ and /edit
                </p>
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Service Account JSON *
                </label>
                <textarea
                  value={sheetConfig.serviceAccount}
                  onChange={(e) => setSheetConfig({...sheetConfig, serviceAccount: e.target.value})}
                  rows="8"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 font-mono text-xs"
                  placeholder='Paste entire JSON content from downloaded key file'
                />
                <p className="text-xs text-gray-500 mt-1">
                  Download from Google Cloud Console → Service Accounts → Keys
                </p>
              </div>

              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h3 className="font-semibold text-blue-900 mb-2">Setup Instructions:</h3>
                <ol className="text-sm text-blue-800 space-y-1 list-decimal list-inside">
                  <li>Create service account in Google Cloud Console</li>
                  <li>Download JSON key file</li>
                  <li>Share your Google Sheet with service account email</li>
                  <li>Give it Editor permissions</li>
                  <li>Paste credentials here and save</li>
                </ol>
              </div>

              <div className="flex justify-end space-x-3 pt-4">
                <button
                  onClick={() => setShowSettings(false)}
                  className="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
                >
                  Cancel
                </button>
                <button
                  onClick={saveSettings}
                  className="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center space-x-2"
                >
                  <CheckCircle className="w-5 h-5" />
                  <span>Save Settings</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      <div className="flex h-screen overflow-hidden">
        {sidebarOpen && (
          <div 
            className="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
            onClick={() => setSidebarOpen(false)}
          />
        )}

        <div className={`fixed lg:static inset-y-0 left-0 transform ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0 transition-transform duration-300 ease-in-out z-50 w-64 bg-white border-r border-gray-200 flex flex-col`}>
          <div className="p-6 border-b border-gray-200">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center transform rotate-45">
                  <div className="transform -rotate-45 text-white font-bold text-xl">H</div>
                </div>
                <div>
                  <h1 className="text-xl font-bold text-gray-900">Content Hub</h1>
                  <p className="text-xs text-gray-500">Brand Calendar</p>
                </div>
              </div>
              <button 
                onClick={() => setSidebarOpen(false)}
                className="lg:hidden text-gray-500 hover:text-gray-700"
              >
                <X className="w-6 h-6" />
              </button>
            </div>
          </div>

          <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
            <button
              onClick={() => {
                setActiveView('dashboard');
                setSidebarOpen(false);
              }}
              className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg font-medium transition-all ${
                activeView === 'dashboard'
                  ? 'bg-red-50 text-red-600 border border-red-200'
                  : 'text-gray-600 hover:bg-gray-50'
              }`}
            >
              <BarChart3 className="w-5 h-5" />
              <span>Dashboard</span>
            </button>
            <button
              onClick={() => {
                setActiveView('admin');
                setEditingPost(null);
                resetForm();
                setSidebarOpen(false);
              }}
              className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg font-medium transition-all ${
                activeView === 'admin'
                  ? 'bg-red-50 text-red-600 border border-red-200'
                  : 'text-gray-600 hover:bg-gray-50'
              }`}
            >
              <Plus className="w-5 h-5" />
              <span>Add Post</span>
            </button>

            <div className="pt-4 border-t border-gray-200">
              <button
                onClick={() => setShowSettings(true)}
                className="w-full flex items-center space-x-3 px-4 py-3 rounded-lg font-medium text-gray-600 hover:bg-gray-50 transition-all"
              >
                <Settings className="w-5 h-5" />
                <span>Settings</span>
              </button>
              <button
                onClick={() => loadFromSheets()}
                disabled={isSyncing}
                className="w-full flex items-center space-x-3 px-4 py-3 rounded-lg font-medium text-gray-600 hover:bg-gray-50 transition-all disabled:opacity-50"
              >
                <RefreshCw className={`w-5 h-5 ${isSyncing ? 'animate-spin' : ''}`} />
                <span>Sync Now</span>
              </button>
            </div>
          </nav>

          <div className="p-4 border-t border-gray-200 space-y-3">
            {syncStatus.message && (
              <div className={`flex items-center space-x-2 p-2 rounded-lg text-sm ${
                syncStatus.type === 'success' ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'
              }`}>
                {syncStatus.type === 'success' ? 
                  <CheckCircle className="w-4 h-4" /> : 
                  <AlertCircle className="w-4 h-4" />
                }
                <span className="text-xs">{syncStatus.message}</span>
              </div>
            )}
            <div className="bg-gradient-to-br from-red-500 to-pink-600 rounded-lg p-4 text-white">
              <div className="flex items-center justify-between mb-2">
                <Calendar className="w-6 h-6" />
                <span className="text-2xl font-bold">{posts.length}</span>
              </div>
              <p className="text-sm font-medium">Total Posts</p>
              {isConnected && (
                <div className="mt-2 flex items-center space-x-1 text-xs">
                  <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                  <span>Sheets Connected</span>
                </div>
              )}
            </div>
          </div>
        </div>

        <div className="flex-1 flex flex-col overflow-hidden">
          <header className="bg-white border-b border-gray-200 px-4 sm:px-8 py-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-3">
                <button
                  onClick={() => setSidebarOpen(true)}
                  className="lg:hidden text-gray-500 hover:text-gray-700"
                >
                  <Menu className="w-6 h-6" />
                </button>
                <div>
                  <h2 className="text-xl sm:text-2xl font-bold text-gray-900">
                    {activeView === 'dashboard' ? 'Content Dashboard' : editingPost ? 'Edit Post' : 'Create New Post'}
                  </h2>
                  <p className="text-xs sm:text-sm text-gray-500 mt-1">
                    {activeView === 'dashboard' ? 'Manage and track your content calendar' : 'Fill in the details below'}
                  </p>
                </div>
              </div>
              {activeView === 'dashboard' && (
                <button
                  onClick={exportToCSV}
                  className="hidden sm:flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium transition-colors"
                >
                  <Download className="w-5 h-5" />
                  <span>Export</span>
                </button>
              )}
            </div>
          </header>

          <main className="flex-1 overflow-y-auto p-4 sm:p-8">
            {activeView === 'admin' && (
              <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-8">
                  {editingPost && (
                    <div className="flex items-center justify-between mb-6 pb-6 border-b border-gray-200">
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                          <Edit2 className="w-5 h-5 text-red-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900">Editing Post</h3>
                          <p className="text-sm text-gray-500">Update details</p>
                        </div>
                      </div>
                      <button
                        onClick={() => {
                          setEditingPost(null);
                          resetForm();
                        }}
                        className="text-gray-400 hover:text-gray-600"
                      >
                        <X className="w-6 h-6" />
                      </button>
                    </div>
                  )}

                  <div className="space-y-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Post Title *</label>
                      <input
                        type="text"
                        name="title"
                        value={formData.title}
                        onChange={handleInputChange}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                        placeholder="Enter post title"
                      />
                    </div>

                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Tag *</label>
                        <input
                          type="text"
                          name="tag"
                          value={formData.tag}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                          placeholder="Marketing"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Topic *</label>
                        <input
                          type="text"
                          name="topic"
                          value={formData.topic}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                          placeholder="Main topic"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Platform *</label>
                        <select
                          name="platform"
                          value={formData.platform}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                        >
                          {platformOptions.map(platform => (
                            <option key={platform} value={platform}>{platform}</option>
                          ))}
                        </select>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Description *</label>
                      <textarea
                        name="description"
                        value={formData.description}
                        onChange={handleInputChange}
                        rows="5"
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                        placeholder="Describe your post"
                      />
                    </div>

                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Scheduled Date *</label>
                        <input
                          type="date"
                          name="date"
                          value={formData.date}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">Status *</label>
                        <select
                          name="status"
                          value={formData.status}
                          onChange={handleInputChange}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                        >
                          {statusOptions.map(status => (
                            <option key={status} value={status}>{status}</option>
                          ))}
                        </select>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">Post Link (Optional)</label>
                      <input
                        type="url"
                        name="link"
                        value={formData.link}
                        onChange={handleInputChange}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                        placeholder="https://example.com"
                      />
                    </div>

                    <div className="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 pt-6 border-t border-gray-200">
                      <button
                        type="button"
                        onClick={resetForm}
                        className="w-full sm:w-auto px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium"
                      >
                        Clear
                      </button>
                      <button
                        type="button"
                        onClick={handleSubmit}
                        className="w-full sm:w-auto px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium flex items-center justify-center space-x-2"
                      >
                        <Plus className="w-5 h-5" />
                        <span>{editingPost ? 'Update Post' : 'Create Post'}</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {activeView === 'dashboard' && (
              <div className="space-y-6">
                <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-6">
                  {statusOptions.map((status, idx) => {
                    const colors = ['from-gray-500 to-gray-600', 'from-blue-500 to-blue-600', 'from-green-500 to-green-600', 'from-orange-500 to-orange-600'];
                    return (
                      <div key={status} className="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                        <div className={`w-10 h-10 rounded-lg bg-gradient-to-br ${colors[idx]} flex items-center justify-center mb-3`}>
                          <TrendingUp className="w-5 h-5 text-white" />
                        </div>
                        <div className="text-2xl sm:text-3xl font-bold text-gray-900 mb-1">
                          {posts.filter(p => p.status === status).length}
                        </div>
                        <div className="text-xs sm:text-sm font-medium text-gray-500">{status}</div>
                      </div>
                    );
                  })}
                  <div className="bg-gradient-to-br from-red-500 to-pink-600 rounded-xl shadow-sm p-4 text-white col-span-2 sm:col-span-1">
                    <Calendar className="w-10 h-10 mb-3" />
                    <div className="text-2xl sm:text-3xl font-bold mb-1">{posts.length}</div>
                    <div className="text-xs sm:text-sm font-medium opacity-90">Total Posts</div>
                  </div>
                </div>

                {upcomingPosts.length > 0 && (
                  <div className="bg-gradient-to-r from-red-500 to-pink-600 rounded-xl shadow-lg p-4 sm:p-6 text-white">
                    <div className="flex items-center justify-between mb-4">
                      <div className="flex items-center space-x-2 sm:space-x-3">
                        <Calendar className="w-5 h-5 sm:w-6 sm:h-6" />
                        <h3 className="text-lg sm:text-xl font-bold">Upcoming This Week</h3>
                      </div>
                      <span className="px-2 sm:px-3 py-1 bg-white bg-opacity-20 rounded-full text-xs sm:text-sm font-semibold">
                        {upcomingPosts.length}
                      </span>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                      {upcomingPosts.slice(0, 3).map(post => (
                        <div key={post.id} className="bg-white bg-opacity-10 backdrop-blur rounded-lg p-3 sm:p-4 border border-white border-opacity-20">
                          <div className="font-semibold mb-2 text-sm sm:text-base">{post.title}</div>
                          <div className="text-xs sm:text-sm opacity-90">{new Date(post.date).toLocaleDateString('en-GB')} • {post.platform}</div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6">
                  <div className="flex items-center space-x-3 mb-4">
                    <Search className="w-5 h-5 text-gray-400" />
                    <h3 className="text-base sm:text-lg font-semibold text-gray-900">Filter & Search</h3>
                  </div>
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
                    <div className="sm:col-span-2">
                      <input
                        type="text"
                        placeholder="Search..."
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"
                      />
                    </div>
                    <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)} className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                      <option value="All">All Status</option>
                      {statusOptions.map(status => <option key={status} value={status}>{status}</option>)}
                    </select>
                    <select value={filterTag} onChange={(e) => setFilterTag(e.target.value)} className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                      {getUniqueTags().map(tag => <option key={tag} value={tag}>{tag === 'All' ? 'All Tags' : tag}</option>)}
                    </select>
                    <select value={filterPlatform} onChange={(e) => setFilterPlatform(e.target.value)} className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
                      <option value="All">All Platforms</option>
                      {platformOptions.map(platform => <option key={platform} value={platform}>{platform}</option>)}
                    </select>
                  </div>
                  <div className="mt-4 flex flex-col sm:flex-row justify-between space-y-3 sm:space-y-0">
                    <div className="text-sm text-gray-600">
                      <span className="font-semibold text-red-600">{filteredPosts.length}</span> of {posts.length} posts
                    </div>
                    <select value={dateRange} onChange={(e) => setDateRange(e.target.value)} className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 text-sm">
                      <option value="All">All Time</option>
                      <option value="Today">Today</option>
                      <option value="This Week">This Week</option>
                      <option value="This Month">This Month</option>
                      <option value="Past">Past</option>
                    </select>
                  </div>
                </div>

                {filteredPosts.length === 0 ? (
                  <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center">
                    <Calendar className="w-16 h-16 mx-auto mb-4 text-gray-300" />
                    <h3 className="text-lg font-semibold text-gray-900 mb-2">No posts found</h3>
                    <p className="text-gray-500">Adjust filters or create a new post</p>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                    {filteredPosts.map(post => (
                      <div key={post.id} className="bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                        <div className="p-4 sm:p-6">
                          <div className="flex flex-wrap gap-2 mb-3">
                            <span className="px-2 py-1 text-xs font-semibold bg-red-100 text-red-700 rounded-full">{post.tag}</span>
                            <span className="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-700 rounded-full">{post.platform}</span>
                          </div>
                          <h3 className="text-base sm:text-lg font-bold text-gray-900 mb-2 line-clamp-2">{post.title}</h3>
                          <p className="text-sm text-gray-600 line-clamp-2 mb-3">{post.description}</p>
                          <div className="flex items-center space-x-2 text-sm text-gray-500 mb-4">
                            <Calendar className="w-4 h-4" />
                            <span>{new Date(post.date).toLocaleDateString('en-GB')}</span>
                          </div>
                          <select
                            value={post.status}
                            onChange={(e) => handleStatusChange(post.id, e.target.value)}
                            className="w-full px-3 py-2 text-sm font-medium border rounded-lg mb-4 cursor-pointer focus:ring-2 focus:ring-red-500"
                          >
                            {statusOptions.map(status => <option key={status} value={status}>{status}</option>)}
                          </select>
                          <div className="flex items-center justify-between pt-4 border-t border-gray-100">
                            <div className="flex items-center space-x-2">
                              {post.link && (
                                <a href={post.link} target="_blank" rel="noopener noreferrer" className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg">
                                  <ExternalLink className="w-4 h-4" />
                                </a>
                              )}
                              <button onClick={() => handleDuplicate(post)} className="p-2 text-green-600 hover:bg-green-50 rounded-lg">
                                <Copy className="w-4 h-4" />
                              </button>
                              <button onClick={() => handleEdit(post)} className="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                                <Edit2 className="w-4 h-4" />
                              </button>
                            </div>
                            <button onClick={() => handleDelete(post.id)} className="p-2 text-red-600 hover:bg-red-50 rounded-lg">
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      </div>
    </div>
  );
};

export default ContentCalendarDashboard;
// export default ContentCalendarDashboard;